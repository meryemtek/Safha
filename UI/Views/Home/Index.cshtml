@model List<Entities.Book>

@{
    ViewData["Title"] = "Ana Sayfa";
}

<div class="home-content">
        <!-- √úst Arama √áubuƒüu -->
        <div class="top-search-bar">
            <div class="search-container">
                <form method="get" action="/Book/Search" class="search-form">
                    <input type="text" name="query" class="search-input" placeholder="Kitap adƒ±, yazar veya ISBN ara..." required />
                    <button type="submit" class="search-button">
                        <i class="search-icon">üîç</i>
                    </button>
                </form>
            </div>
        </div>

        <!-- G√ºndem ve Kitap Alƒ±ntƒ±larƒ± -->
        <div class="content-area">
            <div class="trending-section">
                <h2>üìñ Son Alƒ±ntƒ±lar</h2>
                <div class="quotes-grid">
                    @if (ViewBag.RecentQuotes != null && ((List<UI.Models.QuoteViewModel>)ViewBag.RecentQuotes).Any())
                    {
                        @foreach (var quote in (List<UI.Models.QuoteViewModel>)ViewBag.RecentQuotes)
                        {
                            <div class="quote-card">
                                <div class="quote-header">
                                    <div class="quote-user-info">
                                        <a href="@Url.Action("View", "Profile", new { id = quote.UserId })">
                                            <img src="@(string.IsNullOrEmpty(quote.UserProfilePicture) ? "/image/default-avatar.jpg" : quote.UserProfilePicture)" 
                                                 alt="@quote.UserName" class="quote-user-avatar" />
                                        </a>
                                        <div class="quote-user-details">
                                            <a href="@Url.Action("View", "Profile", new { id = quote.UserId })" class="quote-user-name">@quote.UserName</a>
                                            <span class="quote-date">@quote.CreatedAt.ToString("dd MMM yyyy")</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="quote-text">
                                    @quote.Content
                                </div>
                                
                                <div class="quote-meta">
                                    <div class="quote-book-info">
                                        @if (!string.IsNullOrEmpty(quote.BookCoverImage))
                                        {
                                            <div class="book-cover-container">
                                                <img src="@quote.BookCoverImage" alt="@quote.BookTitle" class="book-cover-image" />
                                            </div>
                                        }
                                        <div class="book-details">
                                            <div class="book-title">@quote.BookTitle</div>
                                            <div class="author-name">@quote.BookAuthor</div>
                                        </div>
                                    </div>
                                    @if (!string.IsNullOrEmpty(quote.Author) || quote.PageNumber > 0)
                                    {
                                        <div style="display: flex; gap: 8px; flex-wrap: wrap; font-size: 0.8125rem; color: #65676B;">
                                            @if (!string.IsNullOrEmpty(quote.Author))
                                            {
                                                <span class="quote-author-info">
                                                    <span class="quote-author-label">Alƒ±ntƒ±:</span>
                                                    <span class="quote-author-name">@quote.Author</span>
                                                </span>
                                            }
                                            @if (quote.PageNumber > 0)
                                            {
                                                <span class="quote-page-info">
                                                    <span class="quote-page-label">Sayfa</span>
                                                    <span class="quote-page-number">@quote.PageNumber</span>
                                                </span>
                                            }
                                        </div>
                                    }
                                </div>
                                
                                @if (!string.IsNullOrEmpty(quote.Notes))
                                {
                                    <div class="quote-notes">
                                        @quote.Notes
                                    </div>
                                }
                            </div>
                        }
                    }
                    else
                    {
                        <div class="no-quotes">
                            <div class="no-quotes-icon">üí¨</div>
                            <h4>Hen√ºz Alƒ±ntƒ± Yok</h4>
                            <p>Hen√ºz hi√ß alƒ±ntƒ± eklenmemi≈ü. ƒ∞lk alƒ±ntƒ±yƒ± siz ekleyin!</p>
                        </div>
                    }
                </div>
            </div>
            
            <div class="recent-activity">
                <h3>üïí Son Aktiviteler</h3>
                <div class="activity-list">
                    @if (ViewBag.RecentActivities != null && ((List<UI.Models.ActivityViewModel>)ViewBag.RecentActivities).Any())
                    {
                        @foreach (var activity in (List<UI.Models.ActivityViewModel>)ViewBag.RecentActivities)
                        {
                            <div class="activity-item">
                                <span class="activity-icon">
                                    @(activity.Status switch
                                    {
                                        Entities.ReadingStatus.WantToRead => "üìö",
                                        Entities.ReadingStatus.CurrentlyReading => "üìñ",
                                        Entities.ReadingStatus.Read => "‚úÖ",
                                        _ => "üìñ"
                                    })
                                </span>
                                <span class="activity-text">
                                    <strong>@activity.UserName</strong> 
                                    @(activity.Status switch
                                    {
                                        Entities.ReadingStatus.WantToRead => "okumayƒ± planladƒ±ƒüƒ± kitaplara",
                                        Entities.ReadingStatus.CurrentlyReading => "≈üu anda okuduƒüu kitaplara",
                                        Entities.ReadingStatus.Read => "okuduklarƒ± listesine",
                                        _ => "kitaplƒ±ƒüƒ±na"
                                    })
                                    <strong>"@activity.BookTitle"</strong> kitabƒ±nƒ± ekledi
                                </span>
                                <span class="activity-time">@GetTimeAgo(activity.UpdatedAt)</span>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="no-activities">
                            <div class="no-activities-icon">üïí</div>
                            <h4>Hen√ºz Aktivite Yok</h4>
                            <p>Hen√ºz hi√ß aktivite ger√ßekle≈ümemi≈ü.</p>
                        </div>
                    }
                </div>
            </div>
        </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/home.css" />
}

@functions {
    string GetTimeAgo(DateTime dateTime)
    {
        var timeSpan = DateTime.UtcNow - dateTime;
        
        if (timeSpan.TotalMinutes < 1)
            return "Az √∂nce";
        else if (timeSpan.TotalMinutes < 60)
            return $"{(int)timeSpan.TotalMinutes} dakika √∂nce";
        else if (timeSpan.TotalHours < 24)
            return $"{(int)timeSpan.TotalHours} saat √∂nce";
        else if (timeSpan.TotalDays < 7)
            return $"{(int)timeSpan.TotalDays} g√ºn √∂nce";
        else if (timeSpan.TotalDays < 30)
            return $"{(int)(timeSpan.TotalDays / 7)} hafta √∂nce";
        else if (timeSpan.TotalDays < 365)
            return $"{(int)(timeSpan.TotalDays / 30)} ay √∂nce";
        else
            return $"{(int)(timeSpan.TotalDays / 365)} yƒ±l √∂nce";
    }
}

@section Scripts {
    <script src="~/js/home.js"></script>
}